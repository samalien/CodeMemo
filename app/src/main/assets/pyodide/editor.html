<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeMemo</title>
    <script src="./pyodide.js"></script>
    <style>
        body, html { margin:0; padding:0; height:100%; background:#1e1e1e; overflow:hidden; }
        #editor { width:100%; height:100%; }
    </style>
</head>
<body>
<div id="editor">Chargement de Python...</div>

<script>
    let editor;
    async function initPyodide() {
        self.pyodide = await loadPyodide();
        // Charge Ace Editor depuis CDN (plus rapide)
        const aceScript = document.createElement("script");
        aceScript.src = "https://cdnjs.cloudflare.com/ajax/libs/ace/1.35.2/ace.min.js";
        document.head.appendChild(aceScript);

        aceScript.onload = () => {
            editor = ace.edit("editor");
            editor.setTheme("ace/theme/monokai");
            editor.session.setMode("ace/mode/python");
            editor.setFontSize(16);
            editor.setValue("# Python chargé !", -1);

            // Fonction appelée depuis Android
            window.setCode = (code) => {
                editor.setValue(code, -1);
            };

            window.runCode = async () => {
                const code = editor.getValue();
                try {
                    let result = await pyodide.runPythonAsync(code);
                    window.AndroidOutput.showOutput(result ?? "Exécuté sans erreur");
                } catch (err) {
                    window.AndroidOutput.showOutput("Erreur : " + err.message);
                }
            };

            // SIGNAL À ANDROID : tout est prêt !
            if (window.AndroidOutput) {
                window.AndroidOutput.showOutput("PYODIDE_READY");
            }
        };
    }
    initPyodide();
</script>
</body>
</html>